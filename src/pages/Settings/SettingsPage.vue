<script lang="ts" setup>
import { useAppCaption } from "@/shared/composables/useAppCaption";
import { useGroups } from "@/store/groups/groups";
import { useVk } from "@/store/vk/vk";
import {
  actionSwipesDefaults,
  actionSwipesOptions,
  actionSwipesSelectLabels,
  icons,
  styledIcons,
} from "@/shared/constants/consts";
import { useDialog } from "@/store/dialog/dialog";
import SettingsDisabledCookies from "@/pages/Settings/SettingsDisabledCookies.vue";
import FixedTeleport from "@/components/FixedTeleport.vue";
import { useApp } from "@/store/app/app";
import PhotoCounter from "@/pages/Album/PhotoCounter.vue";
import { h } from "vue";

useAppCaption("–ù–∞—Å—Ç—Ä–æ–π–∫–∏");
const appStore = useApp();
const groupsStore = useGroups();
const vkStore = useVk();
const dialogStore = useDialog();
</script>

<template>
  <FixedTeleport to="#navigation-header__right">
    <VBtn
      :color="
        groupsStore.spaceUsed >= 80 ? 'deep-orange-darken-4' : 'green-darken-3'
      "
      :icon="icons.Icon24CloudOutline"
      variant="text"
      @click="
        dialogStore.alert(
          `–£ –í–∞—Å –∑–∞–Ω—è—Ç–æ ${groupsStore.spaceUsed}% –∏–∑ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –¥–ª—è –≥—Ä—É–ø–ø –º–µ—Å—Ç–∞. –ï—Å–ª–∏ –∑–∞–Ω—è—Ç—å –±–æ–ª–µ–µ 100%, —Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–º–æ–≥—É—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è.`,
        )
      "
    />
  </FixedTeleport>
  <VCard class="overflow-block a-settings">
    <VCardSubtitle style="padding-block: 12px">üîß –û—Å–Ω–æ–≤–Ω—ã–µ</VCardSubtitle>
    <VDivider />
    <div class="d-flex flex-wrap">
      <SettingsDisabledCookies />
    </div>
    <VCardItem :append-icon="icons.Icon24MemoryCard">
      <VSwitch
        v-model="groupsStore.config.autoSave"
        hide-details
        label="–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä—É–ø–ø"
      />
      <span class="a-mini-text">
        –ó–∞–ø—Ä–æ—Å—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –¥–æ —Ç—ã—Å—è—á–∏ –≤ —á–∞—Å; –ó–∞ —ç—Ç–æ—Ç —Å–µ–∞–Ω—Å –í—ã —É–∂–µ —Å–¥–µ–ª–∞–ª–∏:
        {{ vkStore.vkWebAppStorageSetCount }}. –ï—Å–ª–∏ –í—ã –ø–æ–ø—ã—Ç–∞–µ—Ç–µ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è
        –ø—Ä–∏ –ª–∏–º–∏—Ç–µ - –≤—Å–µ –≥—Ä—É–ø–ø—ã –±—É–¥—É—Ç —É—Ç–µ—Ä—è–Ω—ã!
        <br />
        –≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫. –û–Ω–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è
        –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ.
      </span>
      <VBtn
        v-if="!groupsStore.config.autoSave"
        style="margin-top: 10px"
        variant="tonal"
        @click="groupsStore.saveCurrentLocalGroups()"
      >
        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥—Ä—É–ø–ø—ã
      </VBtn>
    </VCardItem>
    <VDivider />
    <VCardItem :append-icon="icons.Icon240CircleOutline">
      <VSwitch
        v-model="groupsStore.config.showCounters"
        hide-details
        label="–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å—á—ë—Ç—á–∏–∫–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–æ—Ç–æ\–≤–∏–¥–µ–æ –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ"
      />
      <span class="a-mini-text">
        –ï—Å–ª–∏ –æ–ø—Ü–∏—è –≤—ã–∫–ª—é—á–µ–Ω–∞, —Ç–æ –í—ã –º–æ–∂–µ—Ç–µ –≤—Ä—É—á–Ω—É—é –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—á—ë—Ç—á–∏–∫–∏ –ø–æ –∫–ª–∏–∫—É
        –Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫—É –≥—Ä—É–ø–ø—ã.
      </span>
    </VCardItem>
    <VDivider />
    <VCardSubtitle style="padding-block: 12px"> üåÖ –ì–∞–ª–µ—Ä–µ—è</VCardSubtitle>
    <VDivider />
    <VCardItem :append-icon="icons.Icon24Attachments">
      <VSwitch
        v-model="groupsStore.config.gallery"
        hide-details
        label="–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≥–∞–ª–µ—Ä–µ—è"
      />
      <span class="a-mini-text">
        –ü–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≥–∞–ª–µ—Ä–µ—è. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏
        –∫–ª–∏–∫–µ –ø–æ —Å—á—ë—Ç—á–∏–∫–∞–º —Ñ–æ—Ç–æ/–∞–ª—å–±–æ–º–æ–≤.
      </span>
    </VCardItem>
    <VDivider />
    <VCardItem :append-icon="icons.Icon24SunOutline" style="margin-top: 10px">
      <div style="margin-bottom: 10px">
        –ù–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Å—á—ë—Ç—á–∏–∫–∞ –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —Ñ–æ—Ç–æ
      </div>
      <VSlider
        :append-icon="icons.Icon12View"
        :max="100"
        :min="0"
        :model-value="groupsStore.config.opacityGalleryCounter ?? 100"
        :prepend-icon="h(icons.Icon12View, { style: { opacity: 0.1 } }) as any"
        hide-details
        thumb-label
        @update:model-value="groupsStore.config.opacityGalleryCounter = $event"
      />
      <span class="a-mini-text">
        –í—ã –º–æ–∂–µ—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å —Å—á—ë—Ç—á–∏–∫.
      </span>
      <PhotoCounter
        :count="100"
        :photo-index="0"
        date-time="01.01.2024, 00:00"
        show-info
        style="margin-top: 5px"
      />
    </VCardItem>
    <VDivider />
    <VCardItem
      :append-icon="icons.Icon24RectrangleHandPointUp"
      style="margin-top: 10px"
    >
      <div style="margin-bottom: 10px">
        –î–µ–π—Å—Ç–≤–∏—è –∂–µ—Å—Ç–æ–≤ –¥–ª—è —Å–µ–Ω—Å–æ—Ä–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —Ñ–æ—Ç–æ
      </div>
      <VSelect
        v-for="swipeKey of Object.keys(actionSwipesDefaults)"
        :items="actionSwipesOptions"
        :label="actionSwipesSelectLabels[swipeKey as never]"
        :model-value="groupsStore.swipesConfig[swipeKey as never]"
        item-title="title"
        item-value="value"
        style="max-width: 450px"
        @update:model-value="groupsStore.setSwipeKey(swipeKey as never, $event)"
      >
      </VSelect>
    </VCardItem>
    <VDivider />
    <VCardItem :append-icon="icons.Icon24ShadowsOutline">
      <VSwitch
        v-model="groupsStore.config.previewSizeShadow"
        hide-details
        label="–ü–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å –º–∏–Ω–∏–∞—Ç—é—Ä—ã —Å —É—á—ë—Ç–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ñ–æ—Ç–æ"
      />
      <span class="a-mini-text">
        –§–æ—Ç–æ —Å –Ω–∏–∑–∫–∏–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º –±—É–¥–µ—Ç –ø–æ–¥—Å–≤–µ—á–µ–Ω–æ –∫—Ä–∞—Å–Ω—ã–º —Ü–≤–µ—Ç–æ–º, –∞ —Å –≤—ã—Å–æ–∫–∏–º -
        –∑–µ–ª—ë–Ω—ã–º.
      </span>
    </VCardItem>
    <VDivider />
    <VCardSubtitle style="padding-block: 12px"> üêû –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</VCardSubtitle>
    <VDivider />
    <VCardItem :append-icon="icons.Icon24Bug">
      <VSwitch
        v-model="appStore.config.eruda"
        hide-details
        label="–û—Ç–ª–∞–¥–∫–∞ (eruda)"
      />
    </VCardItem>
    <VDivider style="margin-bottom: 10px" />
    <VCardItem :append-icon="styledIcons.Icon24ClearDataOutline">
      <VBtn variant="tonal" @click="groupsStore.clearCachedGroups()">
        –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à —Å—á—ë—Ç—á–∏–∫–æ–≤
      </VBtn>
    </VCardItem>
    <VCardItem :append-icon="icons.Icon24QuestionOutline">
      <VBtn variant="tonal" @click="appStore.initSlides()">
        –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
      </VBtn>
    </VCardItem>
  </VCard>
</template>

<style lang="scss">
.a-settings {
  .v-card-item__content {
    overflow: visible;
  }

  .v-card-item {
  }
}
</style>
